---
title: "任务执行/邮件发送策略"
---

import ImageChanger from "@site/src/components/ImageChanger";

## 定时检测任务执行策略 {#task-execution-strategy}  

### 定时检测任务的截止时间
点数小于等于80的用户，创建的任务的截止时间最晚为<b>7天</b>后。  
点数大于80的用户，创建的任务的截止时间最晚为<b>30天</b>后。  
任务截止时间输入框的默认值为<b>7天</b>后。  

### 定时检测任务的间隔  
定时检测任务的最小间隔为10分钟。  
当不符合以上条件时，创建任务页面会给出提示，同时“创建任务”按钮变灰，无法点击。  

> 如图所示：  <ImageChanger src="/img/faq/task_and_email_strategy/1-zh.png" />  
  
  <br />
同时， 因为我们需要15分钟来分配任务到不同的服务器，因此在15分钟内的第一个定时检测任务将被忽略。  

### 单次检测任务所花费的时间限制  
单次检测任务的时间限制为<b>7秒钟</b>。  
对于大多是检测任务，7秒钟是一个合理的限制，完全够用。  
若超时仍未检测到相应区域的网页文本，则报错的err信息为`pptr script timeout`。  
您可以在任务列表的导出csv文件中查看任务的err信息。  
若多次任务均超时，请在充值页面中查看我们的联系方式，以获取帮助。


## 邮件发送策略 {#email-send-strategy}  
若四小时内网页出现了多次变动，则只会在四小时内的首次变动时，尝试发送提醒邮件。

:::tip
1. 对于某次网页变动，会尝试发送邮件提醒（若四小时内已有相同任务的变动提醒邮件，则不会尝试发送）。  
若提醒邮件发送失败，本次网页变动不会再次尝试发送邮件，但会在下次检测到变动时，使用备选邮件发送服务商，立即尝试发送提醒邮件
（不受四小时仅一封邮件的限制）。  
2. 若此前的**4次**网页变动的邮件提醒均发送失败，则在接下来的任务中，一个小时内，仅尝试最多发送一次提醒邮件。  
（防止某些高频率的检测任务因邮件服务器的暂时宕机而频繁发送邮件，对低频率间隔大于一小时的检测任务无影响）  
3. 若此前的**11次**网页变动的邮件提醒均发送失败，则重置任务失败次数。（然后回到第1步的逻辑）  
:::  

> 源代码在 [这里](https://github.com/lgh06/web-page-monitor/blob/0.0.5/packages/worker-scheduler/alertProviders/nodemailer.mjs#L164)。
如果有更好的建议，欢迎提交issue。